<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>imunano33: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">imunano33
   &#160;<span id="projectnumber">0.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">imunano33 Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md12">Overview</a><ul><li class="level2"><a href="#autotoc_md13">Links</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md14">Installation</a><ul><li class="level2"><a href="#autotoc_md15">Single Include</a></li>
<li class="level2"><a href="#autotoc_md16">Copying Folder</a></li>
<li class="level2"><a href="#autotoc_md17">CMake Submodule</a></li>
<li class="level2"><a href="#autotoc_md18">CMake Global Install</a></li>
<li class="level2"><a href="#autotoc_md19">Embedding on an Arduino</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md20">Theory</a><ul><li class="level2"><a href="#autotoc_md21">Axes Definitions</a></li>
<li class="level2"><a href="#autotoc_md22">Quaternions</a><ul><li class="level3"><a href="#autotoc_md23">Definitions</a></li>
<li class="level3"><a href="#autotoc_md24">Rotating Vectors</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md25">Complementary Filter</a><ul><li class="level3"><a href="#autotoc_md26">Gyro Integration</a></li>
<li class="level3"><a href="#autotoc_md27">Angle Correction</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md28">Usage</a><ul><li class="level2"><a href="#autotoc_md29">Math Utilities</a></li>
<li class="level2"><a href="#autotoc_md30">Initialization</a></li>
<li class="level2"><a href="#autotoc_md31">Climate</a></li>
<li class="level2"><a href="#autotoc_md32">IMU</a></li>
<li class="level2"><a href="#autotoc_md33">IMU and Climate</a></li>
<li class="level2"><a href="#autotoc_md34">More usage information</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md35">License</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md12"></a>
Overview</h1>
<p>IMUNano33 is a data processor library for the sensors on an Arduino Nano 33 BLE Sense, namely the:</p>
<ul>
<li>HTS221 for temperature and humidity</li>
<li>LPS22HB for air pressure</li>
<li>LSM9DS1 IMU, whose accelerometer and gyroscope are used</li>
</ul>
<p>The HTS221 and LPS22HB are used for climate data, and the LSM9DS1 is used to determine the orientation of the Arduino Nano. It uses the gyroscope to integrate the angular rates and then corrects it with the direction of gravity given by the accelerometer. The magnetometer is not used to correct yaw because of high magnetic interference and noise in various applications, and because it is difficult to calibrate properly.</p>
<p>This library only processes the data and does not read in any data. It expects temperature (in Â°C), relative humidity, and air pressure (in kPa) from the climate sensors, and angular velocities about all three axes, accelerations in all three dimensions, and the time between the current and last measurement from the IMU. This data can be a combined input, or read from the climate sensors and the IMU separately (see <a class="el" href="a00051.html#a87e42163dcda1f1edadddea8567a91c4" title="Updates both IMU and climate data.">imunano33::IMUNano33::update()</a>, <a class="el" href="a00051.html#ad0cdf23b65e33a193774464b1a099df7" title="Updates IMU data.">imunano33::IMUNano33::updateIMU()</a>, and <a class="el" href="a00051.html#a5bfd5a31ebc91730ed33e9b6eef5d25e" title="Updates climate data.">imunano33::IMUNano33::updateClimate()</a>). This library can be used on a device such as a Raspberry Pi, which supports the C++ standard library, or it can be used on the Arduino with the macro <code>IMUNANO33_EMBED</code> defined <b>before</b> the include statement.</p>
<p>This library can also be used with an Arduino connected to an MPU-9250 or MPU-6050 IMU along with a DHT22 temperature/humidity sensor and a BMP390 pressure sensor. However, the axes mentioned in the documentation will not match. Additionally, as mentioned above, this library can be used as a standalone orientation calculator or a standalone climate data processor, so it can be used with just a MPU-9250/MPU-6050 or just a DHT22 + BMP390.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Links</h2>
<ul>
<li>Source Code: <a href="https://github.com/jonathanhliu21/imunano33">https://github.com/jonathanhliu21/imunano33</a></li>
<li>Documentation: <a href="https://jonathanhliu21.github.io/imunano33/index.html">https://jonathanhliu21.github.io/imunano33/index.html</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md14"></a>
Installation</h1>
<p>There are four main ways to install this library.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Single Include</h2>
<p>The easiest way to install this library is to download the single include file on the GitHub releases page and place it into a convenient place in your project. The examples below show the include path to be <code><a class="el" href="a00020.html" title="Contains the imunano33::IMUNano33 class.">imunano33/imunano33.hpp</a></code>, but replace this with the include path that you are using to add the library.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Copying Folder</h2>
<p>Another way to install this library is to clone the repository, and copy the <code>include/imunano33</code> directory directly into your project directory, or in a folder designated for third party libraries. This way, you can include the main file, <code><a class="el" href="a00020.html" title="Contains the imunano33::IMUNano33 class.">imunano33/imunano33.hpp</a></code>, anywhere in your project.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
CMake Submodule</h2>
<p>Alternatively, you can use CMake to install this library. The include path would be <code><a class="el" href="a00020.html" title="Contains the imunano33::IMUNano33 class.">imunano33/imunano33.hpp</a></code> for this option. Clone the repository or add it as a submodule, and then type in the following in your CMakeLists.txt:</p>
<div class="fragment"><div class="line"># other build code</div>
<div class="line"> </div>
<div class="line">add_subdirectory(/path/to/imunano33)</div>
<div class="line">target_link_libraries(your_target PUBLIC imunano33::imunano33)</div>
<div class="line"> </div>
<div class="line"># other build code</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
CMake Global Install</h2>
<p>Another alternative is installing the library to the system. First, type in this script:</p>
<div class="fragment"><div class="line">$ cmake -B build -DCMAKE_BUILD_TYPE=Release</div>
<div class="line">$ cmake --build build --target install</div>
</div><!-- fragment --><p>Then, add this to your CMakeLists.txt:</p>
<div class="fragment"><div class="line"># other build code</div>
<div class="line"> </div>
<div class="line">find_package(imunano33 REQUIRED)</div>
<div class="line">target_link_libraries(your_target PUBLIC imunano33::imunano33)</div>
<div class="line"> </div>
<div class="line"># other build code</div>
</div><!-- fragment --><p>The include path will be <code><a class="el" href="a00020.html" title="Contains the imunano33::IMUNano33 class.">imunano33/imunano33.hpp</a></code>.</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Embedding on an Arduino</h2>
<p>As of version 0.1.x, this library can be embedded onto an Arduino.</p>
<p>The only way to install this library with an Arduino is downloading the single include header file from the releases on the GitHub page and copying it into your Arduino project directory.</p>
<p>After installing, it is important to add the following macro to the top of your code, before your include statement. This macro allows the library to know that it is used on an Arduino, without the C++ standard library. Without adding this, the program will not compile.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define IMUNANO33_EMBED</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="a00020.html">imunano33.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="a00051.html">imunano33::IMUNano33</a> processor;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="ttc" id="aa00020_html"><div class="ttname"><a href="a00020.html">imunano33.hpp</a></div><div class="ttdoc">Contains the imunano33::IMUNano33 class.</div></div>
<div class="ttc" id="aa00051_html"><div class="ttname"><a href="a00051.html">imunano33::IMUNano33</a></div><div class="ttdoc">A data processor for IMU and climate data from an Arduino Nano 33 BLE Sense.</div><div class="ttdef"><b>Definition:</b> imunano33.hpp:87</div></div>
</div><!-- fragment --><p>It is important to note that all class and method names are the same regardless of whether the macro is set. The differences are that the embedded library does not use the <code>std</code> namespace or classes/functions from the C++ standard library, it uses <code>float</code> rather than <code>double</code> as its primary number type, and it uses <a class="el" href="a00079.html" title="A minimal 3D vector representation.">svector::EmbVec3D</a> instead of <a class="el" href="a00071.html" title="A simple 3D vector representation.">svector::Vector3D</a> as its primary vector type.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Theory</h1>
<p>This section explains the math behind how this library works. Most of the math for the quaternions and the complementary filter are from these resources:</p>
<ul>
<li><a href="https://jerabaul29.github.io/assets/quaternions/quaternions.pdf">https://jerabaul29.github.io/assets/quaternions/quaternions.pdf</a></li>
<li><a href="https://stanford.edu/class/ee267/notes/ee267_notes_imu.pdf">https://stanford.edu/class/ee267/notes/ee267_notes_imu.pdf</a></li>
<li><a href="https://stanford.edu/class/ee267/lectures/lecture10.pdf">https://stanford.edu/class/ee267/lectures/lecture10.pdf</a></li>
</ul>
<p>In case these links go down, below contains a brief explanation of the math in the links above.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Axes Definitions</h2>
<p>Below shows a diagram and a description of the axes definitions.</p>
<p>With the Arduino flat on a table and the sensors facing up and the opening of the Micro USB port facing towards the front, the positive x direction points towards the front, the positive y direction points perpendicular and to the left, and the positive z direction points directly up. Note that the Arduino may not measure the angular velocities and accelerations with respect to these axes, so you may need to correct the measured values. Positive rotations about an axis mean counterclockwise rotations when viewed from the direction that the axis is pointing.</p>
<div class="image">
<img src="axes.jpeg" alt="" width="50%"/>
</div>
<dl class="section note"><dt>Note</dt><dd>the LSM9DS1 measurements may not be consistent with these axes, so you may need to convert the measurements to fit the axes.</dd></dl>
<h2><a class="anchor" id="autotoc_md22"></a>
Quaternions</h2>
<p>A quaternion consists of 4 components, one of which is the scalar component and the other three are which are the vector component.</p>
<p class="formulaDsp">
\[ q = [q_0, q_1, q_2, q_3] \\ q = [q_0, \vec{v}] \\ \vec{v} = [q_1, q_2, q_3] \]
</p>
<h3><a class="anchor" id="autotoc_md23"></a>
Definitions</h3>
<p>The <b>norm</b> of a quaternion is defined as \(l = \sqrt{q_0^2 + q_1^2 + q_2^2 + q_3^3}\). A unit quaternion has a norm of 1.</p>
<p>The <b>conjugate</b> of a quaternion is defined as \(q^{\star} = [q_0,-q_1,-q_2,-q_3]\).</p>
<p>The <b>inverse</b> of a quaternion is defined as \(q^{-1}=\frac{q^{\star}}{l^2}\). For a unit quaternion, the inverse equals the conjugate.</p>
<p>The <b>product</b> of two quaternions (important for rotations):</p>
<p class="formulaDsp">
\[ [w_1, \vec{v_1}]\cdot[w_2, \vec{v_2}]=[w_1w_2-\vec{v_1} \cdot \vec{v_2}, w_1 \vec{v_2}+w_2 \vec{v_1}+ \vec{v_1}\times \vec{v_2}] \]
</p>
<h3><a class="anchor" id="autotoc_md24"></a>
Rotating Vectors</h3>
<p>A 3D rotation can be described as a unit quaternion. If \(\vec{v_A}\) is the axis of rotation (must be a nonzero vector), and the angle of rotation around this axis is \(\theta\), then the quaternion that can describe this rotation is: \(q_R = [\cos(\frac{\theta}{2}), \sin(\frac{\theta}{2})\frac{\vec{v_A}}{||\vec{v_A}||}]\)</p>
<p>Applying a rotation quaternion to a vector \(\vec{v}\): \([0,\vec{v_R}]=q_R\cdot[0,\vec{v}]\cdot q_R^{\star}\), where \(\vec{v_R}\) is the rotated vector.</p>
<h2><a class="anchor" id="autotoc_md25"></a>
Complementary Filter</h2>
<p>This section goes over the complementary filter that combines the gyroscope and accelerometer data from the IMU. The magnetometer is not used because it is difficult to calibrate, and it needs to be calibrated differently based on different locations due to unpredictable noise.</p>
<p>The sub-sections below go over the steps of the complementary filter.</p>
<h3><a class="anchor" id="autotoc_md26"></a>
Gyro Integration</h3>
<p>Given the angular velocity vector (in all three rotation axes), \(\vec{\omega}\), the delta quaternion is defined as \(q_\Delta = [\Delta{t}||\vec{\omega}||, \frac{\vec{\omega}}{||\vec{\omega}||}]\), where \(\Delta{t}\) is the time between measurements. If \(\vec{\omega}\) is near zero, then this step is skipped. To get the integrated quaternion: \(q_{t\omega}=q_{t-1}q_{\Delta}\), where \(t\) is the current time step and \(t-1\) is the previous time step.</p>
<h3><a class="anchor" id="autotoc_md27"></a>
Angle Correction</h3>
<p>Angle correction is done by the accelerometer by taking a fraction of its measurement, assuming that its measurement points towards the direction of the ground. Because of frequent movement, this fraction is often a very small value. The fraction is given as <code>1 - gyroFavoring</code> (or <code>1 - favoring</code>) in the code. The acceleration vector \(\vec{a}\) is measured by the accelerometer, which is then rotated into world frame from body frame using \(q_{t\omega}\), becoming \(\vec{a_R}\). This vector is then rotated in the direction of the world frame gravity vector \(\vec{g}=[0,0,-1]\). To do this, the axis of rotation \(\vec{v_R}\) is determined by crossing \(\vec{a_R}\times\vec{g}\), and the angle \(\theta\) is determined by \(\arccos{\left(\frac{\vec{a_R}\cdot\vec{g}}{||\vec{a_R}||||\vec{g}||}\right)}\). If either the angle or the axis of rotation vector are zero, then this step is skipped. To have this rotation applied to the original quaternion, we create a rotation quaternion \(q_a\) with an angle of \(\theta\) multiplied by one minus the gyro favoring (<code>1 - gyroFavoring</code> in the code), and the axis of rotation being \(\frac{\vec{v_R}}{||\vec{v_R}||}\). This quaternion would then be multiplied by \(q_{t\omega}\), given above, to give us the final rotation quaternion for the current time step \(t\): \(q_{t\omega}q_a=q_t\).</p>
<h1><a class="anchor" id="autotoc_md28"></a>
Usage</h1>
<p>The main class to use is the <a class="el" href="a00051.html" title="A data processor for IMU and climate data from an Arduino Nano 33 BLE Sense.">imunano33::IMUNano33</a> class. It provides independent methods for processing climate and IMU data, allowing you to ditch the climate or ditch the IMU if you do not have the data from one sensor or the other. However, it is important to know that this is only a data <em>processor</em>, and does not contain code for reading data input. This has to be done on your own.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
Math Utilities</h2>
<p>This library comes with some utility classes for math, namely <a class="el" href="a00071.html" title="A simple 3D vector representation.">svector::Vector3D</a>, from my third-party vectors library, and <a class="el" href="a00059.html" title="A simple quaternion class for rotations.">imunano33::Quaternion</a>, which is used for rotations.</p>
<p>The usage of the third-party vectors library can be found at the simplevectors <a href="https://jonathanhliu21.github.io/simplevectors/a00123.html">documentation page</a>. The basic usage methods of the quaternion class can be found at the class link: <a class="el" href="a00059.html" title="A simple quaternion class for rotations.">imunano33::Quaternion</a>. It should mainly be used for rotations, whose code can be found below:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00020.html">imunano33/imunano33.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="a00059.html">imunano33::Quaternion</a> getRotationQuaternion() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <a class="code" href="a00059.html">imunano33::Quaternion</a> quaternion = getRotationQuaternion();</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Method 1: using the member function, if the quaternion is known</span></div>
<div class="line">  <a class="code" href="a00071.html">svector::Vector3D</a> vec{1, 0, 0};</div>
<div class="line">  <a class="code" href="a00071.html">svector::Vector3D</a> vecRotated1 = quaternion.<a class="code" href="a00059.html#a5d3a6cceccdf4a7ba2aaa2c960534379">rotate</a>(vec);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Method 2: using the static member function, if the quaternion is unknown</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// 90 degrees (pi/2 radians) clockwise around x-axis</span></div>
<div class="line">  vec = {0, 1, 0};</div>
<div class="line">  <a class="code" href="a00071.html">svector::Vector3D</a> axis{1, 0, 0};</div>
<div class="line">  <span class="comment">// make sure that the angle given is in radians</span></div>
<div class="line">  <a class="code" href="a00071.html">svector::Vector3D</a> vecRotated2 = <a class="code" href="a00059.html#a5d3a6cceccdf4a7ba2aaa2c960534379">imunano33::Quaternion::rotate</a>(vec, axis, M_PI / 2);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Method 3: constructing a quaternion, then using the member function</span></div>
<div class="line">  <a class="code" href="a00059.html">imunano33::Quaternion</a> quaternion2{axis, M_PI / 2};</div>
<div class="line">  <a class="code" href="a00071.html">svector::Vector3D</a> vecRotated3 = quaternion2.<a class="code" href="a00071.html#a42b373ed7b3f00c5504f6a0aaf75bc8c">rotate</a>(vec); </div>
<div class="line">}</div>
<div class="ttc" id="aa00059_html"><div class="ttname"><a href="a00059.html">imunano33::Quaternion</a></div><div class="ttdoc">A simple quaternion class for rotations.</div><div class="ttdef"><b>Definition:</b> quaternion.hpp:40</div></div>
<div class="ttc" id="aa00059_html_a5d3a6cceccdf4a7ba2aaa2c960534379"><div class="ttname"><a href="a00059.html#a5d3a6cceccdf4a7ba2aaa2c960534379">imunano33::Quaternion::rotate</a></div><div class="ttdeci">Vector3D rotate(const Vector3D &amp;vec) const</div><div class="ttdoc">Rotates a vector with current quaternion object.</div><div class="ttdef"><b>Definition:</b> quaternion.hpp:268</div></div>
<div class="ttc" id="aa00071_html"><div class="ttname"><a href="a00071.html">svector::Vector3D</a></div><div class="ttdoc">A simple 3D vector representation.</div><div class="ttdef"><b>Definition:</b> simplevectors.hpp:844</div></div>
<div class="ttc" id="aa00071_html_a42b373ed7b3f00c5504f6a0aaf75bc8c"><div class="ttname"><a href="a00071.html#a42b373ed7b3f00c5504f6a0aaf75bc8c">svector::Vector3D::rotate</a></div><div class="ttdeci">Vector3D rotate(const double &amp;ang) const</div><div class="ttdoc">Rotates vector around a certain axis by a certain angle.</div><div class="ttdef"><b>Definition:</b> simplevectors.hpp:1014</div></div>
</div><!-- fragment --><p>Note that unless otherwise specified, all methods that ask you to input an angle are in radians, so you will have to convert degrees to radians.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
Initialization</h2>
<p>There are three different ways to initialize the class. The default constructor makes the gyroscope favoring (mentioned above) to be 0.98, and the rotation angle of the initial rotation quaternion to be zero (initial position determines world frame axes; in other words, future measurements will be relative to the initial position). The first constructor allows you to specify the gyroscope favoring, while the rotation angle of the initial rotation quaternion is still zero. The second constructor allows you to specify the gyroscope favoring and the initial rotation quaternion, where it assumes that the Arduino was rotated before measuring begins.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00020.html">imunano33/imunano33.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <span class="comment">// default constructor</span></div>
<div class="line">  <a class="code" href="a00051.html">imunano33::IMUNano33</a> proc1;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// constructor 1 (gyro favoring)</span></div>
<div class="line">  <a class="code" href="a00051.html">imunano33::IMUNano33</a> proc2{0.99};</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// constructor 2 (gyro favoring, initial quaternion)</span></div>
<div class="line">  <span class="comment">// this example shows an initial counterclockwise rotation around the x-axis</span></div>
<div class="line">  <a class="code" href="a00051.html">imunano33::IMUNano33</a> proc3{0.98, <a class="code" href="a00059.html">imunano33::Quaternion</a>{<a class="code" href="a00071.html">svector::Vector3D</a>{1, 0, 0}, M_PI / 2}};</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31"></a>
Climate</h2>
<p>To update the climate, use <a class="el" href="a00051.html#a5bfd5a31ebc91730ed33e9b6eef5d25e" title="Updates climate data.">imunano33::IMUNano33::updateClimate()</a>. It expects temperature, humidity, and pressure readings from the sensor. The table below shows the units of each quantity that you should measure before passing in the quantity into <a class="el" href="a00051.html#a5bfd5a31ebc91730ed33e9b6eef5d25e" title="Updates climate data.">imunano33::IMUNano33::updateClimate()</a>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Quantity   </th><th class="markdownTableHeadNone">Unit    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Temperature   </td><td class="markdownTableBodyNone">Celsius    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Relative Humidity   </td><td class="markdownTableBodyNone">Percent    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Barometric Pressure   </td><td class="markdownTableBodyNone">Kilopascal   </td></tr>
</table>
<p>Below is an example of updating the data processor with climate data:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00020.html">imunano33/imunano33.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> readTempC() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> readRelativeHumidity() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> readPressurekPa() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <a class="code" href="a00051.html">imunano33::IMUNano33</a> proc;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">    <span class="keywordtype">double</span> curTemp = readTempC();</div>
<div class="line">    <span class="keywordtype">double</span> curHumidity = readRelativeHumidity();</div>
<div class="line">    <span class="keywordtype">double</span> curPressure = readPressurekPa();</div>
<div class="line"> </div>
<div class="line">    proc.<a class="code" href="a00051.html#a5bfd5a31ebc91730ed33e9b6eef5d25e">updateClimate</a>(curTemp, curHumidity, curPressure);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aa00051_html_a5bfd5a31ebc91730ed33e9b6eef5d25e"><div class="ttname"><a href="a00051.html#a5bfd5a31ebc91730ed33e9b6eef5d25e">imunano33::IMUNano33::updateClimate</a></div><div class="ttdeci">void updateClimate(const num_t temperature, const num_t humidity, const num_t pressure)</div><div class="ttdoc">Updates climate data.</div><div class="ttdef"><b>Definition:</b> imunano33.hpp:169</div></div>
</div><!-- fragment --><p>The data processor can convert the current climate data into the following units, shown in the table below:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Quantity   </th><th class="markdownTableHeadNone">Unit    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Temperature   </td><td class="markdownTableBodyNone">Celsius, Fahrenheit, Kelvin    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Relative Humidity   </td><td class="markdownTableBodyNone">Percent    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Barometric Pressure   </td><td class="markdownTableBodyNone">Kilopascal, Standard Atmospheres, Millimeters of Mercury, Pounds per Square Inch   </td></tr>
</table>
<p>Below is an example of converting units.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00020.html">imunano33/imunano33.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> readTempC() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> readRelativeHumidity() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> readPressurekPa() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <a class="code" href="a00051.html">imunano33::IMUNano33</a> proc;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">    <span class="keywordtype">double</span> curTemp = readTempC();</div>
<div class="line">    <span class="keywordtype">double</span> curHumidity = readRelativeHumidity();</div>
<div class="line">    <span class="keywordtype">double</span> curPressure = readPressurekPa();</div>
<div class="line"> </div>
<div class="line">    proc.<a class="code" href="a00051.html#a5bfd5a31ebc91730ed33e9b6eef5d25e">updateClimate</a>(curTemp, curHumidity, curPressure);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> tempC = proc.<a class="code" href="a00051.html#a2fc8b01e98724405a21f0c2c7776f42f">getTemperature</a>&lt;<a class="code" href="a00035.html#a845546b1f1cc1265d5fa65ee9553c1d4a100cecfb8b6fec231f1cdd575f7b18d6">imunano33::CELSIUS</a>&gt;();</div>
<div class="line">    <span class="keywordtype">double</span> tempF = proc.<a class="code" href="a00051.html#a2fc8b01e98724405a21f0c2c7776f42f">getTemperature</a>&lt;<a class="code" href="a00035.html#a845546b1f1cc1265d5fa65ee9553c1d4af1bb8b1c8a51601c1c8dc166661cab3f">imunano33::FAHRENHEIT</a>&gt;();</div>
<div class="line">    <span class="keywordtype">double</span> tempK = proc.<a class="code" href="a00051.html#a2fc8b01e98724405a21f0c2c7776f42f">getTemperature</a>&lt;<a class="code" href="a00035.html#a845546b1f1cc1265d5fa65ee9553c1d4a37b5e49b6d214c7e090cf472e59188a7">imunano33::KELVIN</a>&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> relativeHumidity = proc.<a class="code" href="a00051.html#a3b6ad81d82e371b3e63eba04a5375443">getHumidity</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> pressureKPa = proc.<a class="code" href="a00051.html#ad47a104b754e84dd853906378b2bb5a6">getPressure</a>&lt;<a class="code" href="a00035.html#a4b605fb34b5d58572a4e420811170e6fad064013dd691324beeeea44a96900932">imunano33::KPA</a>&gt;();</div>
<div class="line">    <span class="keywordtype">double</span> pressureAtm = proc.<a class="code" href="a00051.html#ad47a104b754e84dd853906378b2bb5a6">getPressure</a>&lt;<a class="code" href="a00035.html#a4b605fb34b5d58572a4e420811170e6fa8396d5153775bf98a56701e42c477586">imunano33::ATM</a>&gt;();</div>
<div class="line">    <span class="keywordtype">double</span> pressureMmHg = proc.<a class="code" href="a00051.html#ad47a104b754e84dd853906378b2bb5a6">getPressure</a>&lt;<a class="code" href="a00035.html#a4b605fb34b5d58572a4e420811170e6fa251dc12cb851a4e85867599a4b0746d9">imunano33::MMHG</a>&gt;();</div>
<div class="line">    <span class="keywordtype">double</span> pressurePSI = proc.<a class="code" href="a00051.html#ad47a104b754e84dd853906378b2bb5a6">getPressure</a>&lt;<a class="code" href="a00035.html#a4b605fb34b5d58572a4e420811170e6fae441f21ec92ac7c9c621615e422e7d31">imunano33::PSI</a>&gt;();</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aa00035_html_a4b605fb34b5d58572a4e420811170e6fa251dc12cb851a4e85867599a4b0746d9"><div class="ttname"><a href="a00035.html#a4b605fb34b5d58572a4e420811170e6fa251dc12cb851a4e85867599a4b0746d9">imunano33::MMHG</a></div><div class="ttdeci">@ MMHG</div><div class="ttdoc">Converts pressure to millimeters of mercury.</div><div class="ttdef"><b>Definition:</b> unit.hpp:27</div></div>
<div class="ttc" id="aa00035_html_a4b605fb34b5d58572a4e420811170e6fa8396d5153775bf98a56701e42c477586"><div class="ttname"><a href="a00035.html#a4b605fb34b5d58572a4e420811170e6fa8396d5153775bf98a56701e42c477586">imunano33::ATM</a></div><div class="ttdeci">@ ATM</div><div class="ttdef"><b>Definition:</b> unit.hpp:25</div></div>
<div class="ttc" id="aa00035_html_a4b605fb34b5d58572a4e420811170e6fad064013dd691324beeeea44a96900932"><div class="ttname"><a href="a00035.html#a4b605fb34b5d58572a4e420811170e6fad064013dd691324beeeea44a96900932">imunano33::KPA</a></div><div class="ttdeci">@ KPA</div><div class="ttdoc">Converts pressure to kilopascal.</div><div class="ttdef"><b>Definition:</b> unit.hpp:24</div></div>
<div class="ttc" id="aa00035_html_a4b605fb34b5d58572a4e420811170e6fae441f21ec92ac7c9c621615e422e7d31"><div class="ttname"><a href="a00035.html#a4b605fb34b5d58572a4e420811170e6fae441f21ec92ac7c9c621615e422e7d31">imunano33::PSI</a></div><div class="ttdeci">@ PSI</div><div class="ttdoc">Converts pressure to pounds per square inch.</div><div class="ttdef"><b>Definition:</b> unit.hpp:28</div></div>
<div class="ttc" id="aa00035_html_a845546b1f1cc1265d5fa65ee9553c1d4a100cecfb8b6fec231f1cdd575f7b18d6"><div class="ttname"><a href="a00035.html#a845546b1f1cc1265d5fa65ee9553c1d4a100cecfb8b6fec231f1cdd575f7b18d6">imunano33::CELSIUS</a></div><div class="ttdeci">@ CELSIUS</div><div class="ttdoc">Converts temperature to Celsius.</div><div class="ttdef"><b>Definition:</b> unit.hpp:16</div></div>
<div class="ttc" id="aa00035_html_a845546b1f1cc1265d5fa65ee9553c1d4a37b5e49b6d214c7e090cf472e59188a7"><div class="ttname"><a href="a00035.html#a845546b1f1cc1265d5fa65ee9553c1d4a37b5e49b6d214c7e090cf472e59188a7">imunano33::KELVIN</a></div><div class="ttdeci">@ KELVIN</div><div class="ttdoc">Converts temperature to Kelvin.</div><div class="ttdef"><b>Definition:</b> unit.hpp:17</div></div>
<div class="ttc" id="aa00035_html_a845546b1f1cc1265d5fa65ee9553c1d4af1bb8b1c8a51601c1c8dc166661cab3f"><div class="ttname"><a href="a00035.html#a845546b1f1cc1265d5fa65ee9553c1d4af1bb8b1c8a51601c1c8dc166661cab3f">imunano33::FAHRENHEIT</a></div><div class="ttdeci">@ FAHRENHEIT</div><div class="ttdoc">Converts temperature to Fahrenheit.</div><div class="ttdef"><b>Definition:</b> unit.hpp:15</div></div>
<div class="ttc" id="aa00051_html_a2fc8b01e98724405a21f0c2c7776f42f"><div class="ttname"><a href="a00051.html#a2fc8b01e98724405a21f0c2c7776f42f">imunano33::IMUNano33::getTemperature</a></div><div class="ttdeci">num_t getTemperature() const</div><div class="ttdoc">Gets temperature.</div><div class="ttdef"><b>Definition:</b> imunano33.hpp:322</div></div>
<div class="ttc" id="aa00051_html_a3b6ad81d82e371b3e63eba04a5375443"><div class="ttname"><a href="a00051.html#a3b6ad81d82e371b3e63eba04a5375443">imunano33::IMUNano33::getHumidity</a></div><div class="ttdeci">num_t getHumidity() const</div><div class="ttdoc">Gets relative humidity.</div><div class="ttdef"><b>Definition:</b> imunano33.hpp:350</div></div>
<div class="ttc" id="aa00051_html_ad47a104b754e84dd853906378b2bb5a6"><div class="ttname"><a href="a00051.html#ad47a104b754e84dd853906378b2bb5a6">imunano33::IMUNano33::getPressure</a></div><div class="ttdeci">num_t getPressure() const</div><div class="ttdoc">Gets pressure.</div><div class="ttdef"><b>Definition:</b> imunano33.hpp:336</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md32"></a>
IMU</h2>
<p>To update the orientation data, use <a class="el" href="a00051.html#ad0cdf23b65e33a193774464b1a099df7" title="Updates IMU data.">imunano33::IMUNano33::updateIMU()</a>. To use this method, make sure that the readings are consistent with the axes defined above. The unit of the accelermoter readings can be anything, but meters per second squared is recommended because it is in SI units. The unit of the gyroscope readings <b>must</b> be in radians per second. Usually, they are in degrees per second, so they must be converted. The time difference between measurement readings <b>must</b> be in seconds. Below is an example of updating IMU data:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00020.html">imunano33/imunano33.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="a00071.html">svector::Vector3D</a> readGyro() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  <span class="comment">// returns &lt;roll, pitch, yaw&gt;</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="a00071.html">svector::Vector3D</a> readAcc() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> getCurTime() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  <span class="comment">// returns time, in seconds</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <a class="code" href="a00051.html">imunano33::IMUNano33</a> proc;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> prevTime = getCurTime();</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> gyro = readGyro();</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> acc = readAcc();</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> curTime = getCurTime();</div>
<div class="line"> </div>
<div class="line">    proc.<a class="code" href="a00051.html#ad0cdf23b65e33a193774464b1a099df7">updateIMU</a>(acc, gyro, curTime - prevTime);</div>
<div class="line">    </div>
<div class="line">    prevTime = curTime;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aa00051_html_ad0cdf23b65e33a193774464b1a099df7"><div class="ttname"><a href="a00051.html#ad0cdf23b65e33a193774464b1a099df7">imunano33::IMUNano33::updateIMU</a></div><div class="ttdeci">void updateIMU(const Vector3D &amp;accel, const Vector3D &amp;gyro, const num_t deltaT)</div><div class="ttdoc">Updates IMU data.</div><div class="ttdef"><b>Definition:</b> imunano33.hpp:189</div></div>
</div><!-- fragment --><p>If the accelerometer values and gyroscope values are sampled separately, then the <a class="el" href="a00051.html#a2ecea68ab3607cac39ccd0c036ba84fa" title="Updates IMU acceleration data.">imunano33::IMUNano33::updateIMUAccel()</a> and <a class="el" href="a00051.html#a244acf313bda06633392deab0dfdeda6" title="Updates IMU gyroscope data.">imunano33::IMUNano33::updateIMUGyro()</a> methods can be used to update both values on their own:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00020.html">imunano33/imunano33.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="a00071.html">svector::Vector3D</a> readGyro() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  <span class="comment">// returns &lt;roll, pitch, yaw&gt;</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="a00071.html">svector::Vector3D</a> readAcc() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> getCurTime() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  <span class="comment">// returns time, in seconds</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <a class="code" href="a00051.html">imunano33::IMUNano33</a> proc;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> prevTime = getCurTime();</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> gyro = readGyro();</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> acc = readAcc();</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> curTime = getCurTime();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// This is the same as calling proc.updateIMU() in this case</span></div>
<div class="line">    <span class="comment">// because they are sampled at the same time. If the accelerometer</span></div>
<div class="line">    <span class="comment">// and gyro are sampled at different times, each method should</span></div>
<div class="line">    <span class="comment">// be called separately at those times.</span></div>
<div class="line">    proc.<a class="code" href="a00051.html#a244acf313bda06633392deab0dfdeda6">updateIMUGyro</a>(gyro, curTime - prevTime);</div>
<div class="line">    proc.<a class="code" href="a00051.html#a2ecea68ab3607cac39ccd0c036ba84fa">updateIMUAccel</a>(acc);</div>
<div class="line">    </div>
<div class="line">    prevTime = curTime;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aa00051_html_a244acf313bda06633392deab0dfdeda6"><div class="ttname"><a href="a00051.html#a244acf313bda06633392deab0dfdeda6">imunano33::IMUNano33::updateIMUGyro</a></div><div class="ttdeci">void updateIMUGyro(const Vector3D &amp;gyro, const num_t deltaT)</div><div class="ttdoc">Updates IMU gyroscope data.</div><div class="ttdef"><b>Definition:</b> imunano33.hpp:215</div></div>
<div class="ttc" id="aa00051_html_a2ecea68ab3607cac39ccd0c036ba84fa"><div class="ttname"><a href="a00051.html#a2ecea68ab3607cac39ccd0c036ba84fa">imunano33::IMUNano33::updateIMUAccel</a></div><div class="ttdeci">void updateIMUAccel(const Vector3D &amp;accel)</div><div class="ttdoc">Updates IMU acceleration data.</div><div class="ttdef"><b>Definition:</b> imunano33.hpp:201</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><a class="el" href="a00051.html#a2ecea68ab3607cac39ccd0c036ba84fa" title="Updates IMU acceleration data.">imunano33::IMUNano33::updateIMUAccel()</a> and <a class="el" href="a00051.html#a244acf313bda06633392deab0dfdeda6" title="Updates IMU gyroscope data.">imunano33::IMUNano33::updateIMUGyro()</a> are <em>not</em> commutative. <a class="el" href="a00051.html#a244acf313bda06633392deab0dfdeda6" title="Updates IMU gyroscope data.">imunano33::IMUNano33::updateIMUGyro()</a> <em>sets</em> the latest known orientation, while <a class="el" href="a00051.html#a2ecea68ab3607cac39ccd0c036ba84fa" title="Updates IMU acceleration data.">imunano33::IMUNano33::updateIMUAccel()</a> <em>corrects</em> the latest known orientation. If <a class="el" href="a00051.html#a244acf313bda06633392deab0dfdeda6" title="Updates IMU gyroscope data.">imunano33::IMUNano33::updateIMUGyro()</a> is called first, then it rotates the Arduino first and sets the new orientation. Then, this new orientation is corrected with the <a class="el" href="a00051.html#a2ecea68ab3607cac39ccd0c036ba84fa" title="Updates IMU acceleration data.">imunano33::IMUNano33::updateIMUAccel()</a> call. If <a class="el" href="a00051.html#a2ecea68ab3607cac39ccd0c036ba84fa" title="Updates IMU acceleration data.">imunano33::IMUNano33::updateIMUAccel()</a> is called first, then it corrects the <em>previous</em> orientation, and then the Arduino is rotated to a <em>new</em>, <em>uncorrected</em> orientation with <a class="el" href="a00051.html#a244acf313bda06633392deab0dfdeda6" title="Updates IMU gyroscope data.">imunano33::IMUNano33::updateIMUGyro()</a>. <a class="el" href="a00051.html#ad0cdf23b65e33a193774464b1a099df7" title="Updates IMU data.">imunano33::IMUNano33::updateIMU()</a> calls <a class="el" href="a00051.html#a244acf313bda06633392deab0dfdeda6" title="Updates IMU gyroscope data.">imunano33::IMUNano33::updateIMUGyro()</a> first, and then it corrects the orientation with <a class="el" href="a00051.html#a2ecea68ab3607cac39ccd0c036ba84fa" title="Updates IMU acceleration data.">imunano33::IMUNano33::updateIMUAccel()</a>.</dd></dl>
<p>To get the current rotation quaternion, use <a class="el" href="a00051.html#a87c23a6d0a9eba96bc3d77aaaed1e985" title="Gets rotation quaternion of the complementary filter.">imunano33::IMUNano33::getRotQ()</a>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00020.html">imunano33/imunano33.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="a00071.html">svector::Vector3D</a> readGyro() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  <span class="comment">// returns &lt;roll, pitch, yaw&gt;</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="a00071.html">svector::Vector3D</a> readAcc() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> getCurTime() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  <span class="comment">// returns time, in seconds</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <a class="code" href="a00051.html">imunano33::IMUNano33</a> proc;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> prevTime = getCurTime();</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> gyro = readGyro();</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> acc = readAcc();</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> curTime = getCurTime();</div>
<div class="line"> </div>
<div class="line">    proc.<a class="code" href="a00051.html#ad0cdf23b65e33a193774464b1a099df7">updateIMU</a>(acc, gyro, curTime - prevTime);</div>
<div class="line">    </div>
<div class="line">    prevTime = curTime;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="a00059.html">imunano33::Quaternion</a> curQ = proc.<a class="code" href="a00051.html#a87c23a6d0a9eba96bc3d77aaaed1e985">getRotQ</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Gets X, Y, Z axes of Arduino relative to world frame.</span></div>
<div class="line">    <span class="comment">// Does this by rotating the body fram XYZ axes using the rotation </span></div>
<div class="line">    <span class="comment">// quaternion given above.</span></div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> iBodyFrame{1, 0, 0};</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> jBodyFrame{0, 1, 0};</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> kBodyFrame{0, 0, 1};</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> iWorldFrame = curQ.<a class="code" href="a00059.html#a5d3a6cceccdf4a7ba2aaa2c960534379">rotate</a>(iBodyFrame);</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> jWorldFrame = curQ.<a class="code" href="a00059.html#a5d3a6cceccdf4a7ba2aaa2c960534379">rotate</a>(jBodyFrame);</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> kWorldFrame = curQ.<a class="code" href="a00059.html#a5d3a6cceccdf4a7ba2aaa2c960534379">rotate</a>(kBodyFrame);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aa00051_html_a87c23a6d0a9eba96bc3d77aaaed1e985"><div class="ttname"><a href="a00051.html#a87c23a6d0a9eba96bc3d77aaaed1e985">imunano33::IMUNano33::getRotQ</a></div><div class="ttdeci">Quaternion getRotQ() const</div><div class="ttdoc">Gets rotation quaternion of the complementary filter.</div><div class="ttdef"><b>Definition:</b> imunano33.hpp:303</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md33"></a>
IMU and Climate</h2>
<p>If both IMU and climate data are known, then use <a class="el" href="a00051.html#a87e42163dcda1f1edadddea8567a91c4" title="Updates both IMU and climate data.">imunano33::IMUNano33::update()</a>, which takes in both climate and IMU data inputs. For specifications of the inputs, read the sections above. Below shows an example of using the method:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00020.html">imunano33/imunano33.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="a00071.html">svector::Vector3D</a> readGyro() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  <span class="comment">// returns &lt;roll, pitch, yaw&gt;</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="a00071.html">svector::Vector3D</a> readAcc() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> getCurTime() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  <span class="comment">// returns time, in seconds</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> readTempC() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> readRelativeHumidity() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> readPressurekPa() {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <a class="code" href="a00051.html">imunano33::IMUNano33</a> proc;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> prevTime = getCurTime();</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> gyro = readGyro();</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> acc = readAcc();</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> curTime = getCurTime();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> curTemp = readTempC();</div>
<div class="line">    <span class="keywordtype">double</span> curHumidity = readRelativeHumidity();</div>
<div class="line">    <span class="keywordtype">double</span> curPressure = readPressurekPa();</div>
<div class="line"> </div>
<div class="line">    proc.<a class="code" href="a00051.html#a87e42163dcda1f1edadddea8567a91c4">update</a>(acc, gyro, curTime - prevTime, curTemp, curHumidity, curPressure);</div>
<div class="line">    <span class="comment">// above line is equivalent to below two lines</span></div>
<div class="line">    <span class="comment">// proc.updateIMU(acc, gyro, curTime - prevTime);  </span></div>
<div class="line">    <span class="comment">// proc.updateClimate(curTemp, curHumidity, curPressure);</span></div>
<div class="line">    prevTime = curTime;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="a00059.html">imunano33::Quaternion</a> curQ = proc.<a class="code" href="a00051.html#a87c23a6d0a9eba96bc3d77aaaed1e985">getRotQ</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Gets X, Y, Z axes of Arduino relative to world frame.</span></div>
<div class="line">    <span class="comment">// Does this by rotating the body fram XYZ axes using the rotation </span></div>
<div class="line">    <span class="comment">// quaternion given above.</span></div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> iBodyFrame{1, 0, 0};</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> jBodyFrame{0, 1, 0};</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> kBodyFrame{0, 0, 1};</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> iWorldFrame = curQ.<a class="code" href="a00059.html#a5d3a6cceccdf4a7ba2aaa2c960534379">rotate</a>(iBodyFrame);</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> jWorldFrame = curQ.<a class="code" href="a00059.html#a5d3a6cceccdf4a7ba2aaa2c960534379">rotate</a>(jBodyFrame);</div>
<div class="line">    <a class="code" href="a00071.html">svector::Vector3D</a> kWorldFrame = curQ.<a class="code" href="a00059.html#a5d3a6cceccdf4a7ba2aaa2c960534379">rotate</a>(kBodyFrame);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// climate processing</span></div>
<div class="line">    <span class="keywordtype">double</span> tempC = proc.<a class="code" href="a00051.html#a2fc8b01e98724405a21f0c2c7776f42f">getTemperature</a>&lt;<a class="code" href="a00035.html#a845546b1f1cc1265d5fa65ee9553c1d4a100cecfb8b6fec231f1cdd575f7b18d6">imunano33::CELSIUS</a>&gt;();</div>
<div class="line">    <span class="keywordtype">double</span> tempF = proc.<a class="code" href="a00051.html#a2fc8b01e98724405a21f0c2c7776f42f">getTemperature</a>&lt;<a class="code" href="a00035.html#a845546b1f1cc1265d5fa65ee9553c1d4af1bb8b1c8a51601c1c8dc166661cab3f">imunano33::FAHRENHEIT</a>&gt;();</div>
<div class="line">    <span class="keywordtype">double</span> tempK = proc.<a class="code" href="a00051.html#a2fc8b01e98724405a21f0c2c7776f42f">getTemperature</a>&lt;<a class="code" href="a00035.html#a845546b1f1cc1265d5fa65ee9553c1d4a37b5e49b6d214c7e090cf472e59188a7">imunano33::KELVIN</a>&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> relativeHumidity = proc.<a class="code" href="a00051.html#a3b6ad81d82e371b3e63eba04a5375443">getHumidity</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> pressureKPa = proc.<a class="code" href="a00051.html#ad47a104b754e84dd853906378b2bb5a6">getPressure</a>&lt;<a class="code" href="a00035.html#a4b605fb34b5d58572a4e420811170e6fad064013dd691324beeeea44a96900932">imunano33::KPA</a>&gt;();</div>
<div class="line">    <span class="keywordtype">double</span> pressureAtm = proc.<a class="code" href="a00051.html#ad47a104b754e84dd853906378b2bb5a6">getPressure</a>&lt;<a class="code" href="a00035.html#a4b605fb34b5d58572a4e420811170e6fa8396d5153775bf98a56701e42c477586">imunano33::ATM</a>&gt;();</div>
<div class="line">    <span class="keywordtype">double</span> pressureMmHg = proc.<a class="code" href="a00051.html#ad47a104b754e84dd853906378b2bb5a6">getPressure</a>&lt;<a class="code" href="a00035.html#a4b605fb34b5d58572a4e420811170e6fa251dc12cb851a4e85867599a4b0746d9">imunano33::MMHG</a>&gt;();</div>
<div class="line">    <span class="keywordtype">double</span> pressurePSI = proc.<a class="code" href="a00051.html#ad47a104b754e84dd853906378b2bb5a6">getPressure</a>&lt;<a class="code" href="a00035.html#a4b605fb34b5d58572a4e420811170e6fae441f21ec92ac7c9c621615e422e7d31">imunano33::PSI</a>&gt;();</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aa00051_html_a87e42163dcda1f1edadddea8567a91c4"><div class="ttname"><a href="a00051.html#a87e42163dcda1f1edadddea8567a91c4">imunano33::IMUNano33::update</a></div><div class="ttdeci">void update(const Vector3D &amp;accel, const Vector3D &amp;gyro, const num_t deltaT, const num_t temperature, const num_t humidity, const num_t pressure)</div><div class="ttdoc">Updates both IMU and climate data.</div><div class="ttdef"><b>Definition:</b> imunano33.hpp:240</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md34"></a>
More usage information</h2>
<p>More usage information can be found at the <a class="el" href="a00051.html" title="A data processor for IMU and climate data from an Arduino Nano 33 BLE Sense.">imunano33::IMUNano33</a> class documentation page. Note that these documentation pages are generated without the <code>IMUNANO33_EMBED</code> macro and are meant to be used with the Raspberry Pi. However, it is important to note that all class and method names are the same regardless of whether the macro is set. The differences are that it does not use the <code>std</code> namespace or classes/functions from the C++ standard library, it uses <code>float</code> rather than <code>double</code> as its primary number type, and it uses <a class="el" href="a00079.html" title="A minimal 3D vector representation.">svector::EmbVec3D</a> instead of <a class="el" href="a00071.html" title="A simple 3D vector representation.">svector::Vector3D</a> as its primary vector type.</p>
<h1><a class="anchor" id="autotoc_md35"></a>
License</h1>
<p>The MIT License (MIT)</p>
<p>Copyright Â© 2023 Jonathan Liu</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the âSoftwareâ), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED âAS ISâ, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
